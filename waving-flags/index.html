<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./index.css" />
    <title>WEBGL2</title>
</head>

<body onload="main()">
    <canvas id="happy-life-happy-code" width="500" height="500"></canvas>
    <select class="selector">
        <option value="frag-china">中国</option>
        <option value="frag-usa">美国</option>
        <option value="frag-germany">德国</option>
        <option value="frag-japan">日本</option>
    </select>
</body>
<script src="https://webgl2fundamentals.org/webgl/resources/twgl-full.min.js" type="text/javascript"></script>
<script src="https://webgl2fundamentals.org/webgl/resources/webgl-utils.js" type="text/javascript"></script>
<script src="../core/gl-matrix.js" type="text/javascript"></script>
<script src="https://webgl2fundamentals.org/webgl/resources/m4.js" type="text/javascript"></script>
<script src="https://webgl2fundamentals.org/webgl/resources/flattened-primitives.js"></script>

<script type="x-shader/x-vertex" id="vertex">#version 300 es
    in vec4 a_position;
    void main() {
        gl_Position = a_position;
    }
</script>
<script type="x-shader/x-fragment" id="frag-usa">#version 300 es
    precision mediump float;
    uniform vec2 u_resolution;
    uniform float u_time;
    out vec4 FragColor;

    /* Color palette */
    #define BLACK           vec3(0.0, 0.0, 0.0)
    #define WHITE           vec3(1.0, 1.0, 1.0)
    #define RED             vec3(178., 34., 52) / 255.
    #define BLUE            vec3(60., 59.0, 110.0) /255.

    #define PI            3.1415926535


    vec2 Remap(vec2 p, float t, float r, float b, float l) {
        return vec2((p.x - l) / (r - l), (p.y - b) / (t - b));
    }

    float sdStar5(in vec2 p, in float r, in float rf, vec2 offset)
    {
    p -= offset; // This will subtract offset.x from p.x and subtract offset.y from p.y
    const vec2 k1 = vec2(0.809016994375, -0.587785252292);
    const vec2 k2 = vec2(-k1.x,k1.y);
    p.x = abs(p.x);
    p -= 2.0*max(dot(k1,p),0.0)*k1;
    p -= 2.0*max(dot(k2,p),0.0)*k2;
    p.x = abs(p.x);
    p.y -= r;
    vec2 ba = rf*vec2(-k1.y,k1.x) - vec2(0,1);
    float h = clamp( dot(p,ba)/dot(ba,ba), 0.0, r );
    return length(p-ba*h) * sign(p.y*ba.x-p.x*ba.y);
    }

    float Start2(vec2 uv, vec2 num) {
        float ratio = 1.;
        float offset = 1.;
        float star;
        vec2 st = fract(uv * num);
        star = 1. - smoothstep(0., 0.005, sdStar5(st, .25 * ratio, .5, vec2(.5 * offset, 0.5)));
        return star;
    }


    void main() {
        vec2 uv = gl_FragCoord.xy / u_resolution;
        // uv *= 1.1;
        float t = uv.x * 7. - 2. * u_time + uv.y * 3.;
        uv.y +=  sin( t ) * .05;
        // caculate the min pix in y axios;
        float d = 0.01;
        vec3 c = mix(WHITE, RED, smoothstep(d, d + 0.2, sin(uv.y * PI * 13.)));

        vec3 color = c;

    

        color *= smoothstep(d, .005, abs(uv.y - .5) - .5 + d);

        vec2 st = Remap(uv, 1., .4, .46, 0.);

        if(st.x > .0 && st.x <= 1. && st.y <= 1. && st.y > 0.) {
            color = mix(
                mix(color, BLUE, smoothstep(0., .01, st.y)),
                WHITE,
                Start2(st, vec2(6., 5.))
            );

            st = Remap(st, .9, .9166, .1, .0833);

            if(st.x > .0 && st.x <= 1. && st.y <= 1. && st.y > 0.) {
                color = mix(color, WHITE, Start2(st, vec2(5., 4.)));
            }
        }

        color *= .7 + cos(t) * .3;
        FragColor = vec4(color, 1.);
    }
</script>

<script type="x-shader/x-fragment" id="frag-japan">#version 300 es
    precision mediump float;
    uniform vec2 u_resolution;
    uniform float u_time;
    out vec4 FragColor;

    /* Color palette */
    #define BLACK           vec3(0.0, 0.0, 0.0)
    #define WHITE           vec3(1.0, 1.0, 1.0)
    #define RED             vec3(1.0, 0.0, 0.0)

    #define PI            3.1415926535

    vec2 Remap(vec2 p, float t, float r, float b, float l) {
        return vec2((p.x - l) / (r - l), (p.y - b) / (t - b));
    }

    void main() {
        vec2 uv = (gl_FragCoord.xy - .5 * u_resolution) / u_resolution.y;
        
        vec3 bg = vec3(1.0);
        float w = fwidth(uv.y);
        float t = uv.x * 7. - 2. * u_time + uv.y * 5.;
        uv.y +=  sin( t ) * .05;
        bg = mix(bg, RED, (1.0 - smoothstep(.25, .253, length(uv))));
        uv.y += .5;
        uv.x -= .5;
        bg *= smoothstep(w, 0.0, abs(uv.y - .5) - .5 + w);
        bg *= .7 + cos(t) * .3;
        FragColor = vec4(bg, 1.0);
    }
</script>


<script type="x-shader/x-fragment" id="frag-germany">#version 300 es
    precision mediump float;
    uniform vec2 u_resolution;
    uniform float u_time;
    out vec4 FragColor;

    /* Color palette */
    #define BLACK           vec3(0.0, 0.0, 0.0)
    #define WHITE           vec3(1.0, 1.0, 1.0)
    #define RED             vec3(1.0, 0.0, 0.0)
    #define YELLOW          vec3(1.0, 1.0, 0.0)
    #define PI            3.1415926535

    vec2 Remap(vec2 p, float t, float r, float b, float l) {
        return vec2((p.x - l) / (r - l), (p.y - b) / (t - b));
    }

    void main() {
        const float ratio = 1.0 / 3.0;
        vec2 uv = gl_FragCoord.xy / u_resolution.xy;
        float w = fwidth(uv.y);
        float t = uv.x * 7. - 2. * u_time + uv.y * 3.;
        uv.y +=  sin( t ) * .05;

        vec3 a = YELLOW;
        a = mix(a, RED, step(ratio, uv.y));

        a = mix(a, BLACK, step(ratio * 2.0, uv.y));

        a *= smoothstep(w, 0.0, abs(uv.y - .5) - .5 + w);
        a *= .7 + cos(t) * .3;
        
        FragColor = vec4(a, 1.0);
    }
</script>


<script type="x-shader/x-fragment" id="frag-china">#version 300 es
    precision mediump float;
    uniform vec2 u_resolution;
    uniform float u_time;
    out vec4 FragColor;

    void main() {
        FragColor = vec4(1.0, 0.0, 0.0, 1.0);
    }
</script>

<script type="text/javascript" src="./index.js"></script>

</html>